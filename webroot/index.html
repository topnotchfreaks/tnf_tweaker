<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TNF Tweaker</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-zinc-900 text-white min-h-screen flex justify-center items-center p-4">
  <div class="w-[393px] bg-zinc-900 overflow-hidden shadow-2xl">
    <!-- Header -->
    <div class="flex justify-between items-center px-6 pt-6">
      <h1 class="text-xl font-bold tracking-tight">TNF Tweaker</h1>
      <button id="refresh-btn" class="text-gray-400 hover:text-white">
        <img src="assets/refresh.svg" alt="Menu" class="w-6 h-6" />
      </button>
    </div>

    <!-- System Info Card -->
    <div class="bg-zinc-800 rounded-xl p-4 mx-6 mt-4 space-y-3 text-sm shadow-inner">
      <div class="flex items-center space-x-2">
        <img src="assets/cpu.svg" alt="Kernel" class="w-5 h-5" />
        <p>Kernel version<br><span id="kernel-version" class="text-gray-400">Loading...</span></p>
      </div>
      <div class="flex items-center space-x-2">
        <img src="assets/phone.svg" alt="Device" class="w-5 h-5" />
        <p>Device model<br><span id="device-model" class="text-gray-400">Loading...</span></p>
      </div>
      <div class="flex items-center space-x-2">
        <img src="assets/settings.svg" alt="Module" class="w-5 h-5" />
        <p>Module version<br><span id="module-version" class="text-gray-400">Loading...</span></p>
      </div>
      <div class="flex items-center space-x-2">
        <img src="assets/check.svg" alt="Status" class="w-5 h-5" />
        <p>Module Status<br><span id="module-status" class="text-green-400">Working</span></p>
      </div>
    </div>

    <!-- Kernel Profiles -->
    <div class="px-6 mt-6">
      <label class="block mb-2 font-semibold text-sm">Kernel Profiles Mode</label>
      <div class="flex items-center">
        <div id="profile-icon-container" class="relative flex items-center space-x-2 bg-zinc-800 px-4 py-2 rounded-xl shadow flex-1">
          <img id="profile-icon" src="assets/settings.svg" alt="Profile" class="w-5 h-5 min-w-5 min-h-5 max-w-5 max-h-5 transition-all duration-200 object-contain" />
          <select id="profile-select" class="bg-transparent focus:outline-none text-white pr-8 w-full">
            <option value="powersave">Powersave</option>
            <option value="balanced">Balanced</option>
            <option value="performance">Performance</option>
          </select>
        </div>
        <button id="apply-profile" class="ml-4 bg-red-500 text-white px-6 py-2 rounded-xl font-semibold shadow hover:scale-105 transition-transform whitespace-nowrap">
          Apply
        </button>
      </div>
    </div>

    <!-- Bypass Charging -->
    <div class="px-6 mt-6">
      <label class="block mb-2 font-semibold text-sm">Bypass Charging</label>
      <div class="flex justify-between items-center bg-zinc-800 px-4 py-3 rounded-xl shadow">
        <div class="flex items-center space-x-2">
          <img src="assets/charging.svg" alt="Bypass Charging" class="w-5 h-5" />
          <span id="bypass-status">Disabled</span>
        </div>
        <!-- Toggle Switch -->
        <label class="relative inline-flex items-center cursor-pointer">
          <input id="bypass-toggle" type="checkbox" class="sr-only peer">
          <div class="w-11 h-6 bg-zinc-700 peer-focus:outline-none rounded-full peer peer-checked:bg-red-500 transition-colors"></div>
          <div class="absolute left-0.5 top-0.5 w-5 h-5 bg-white rounded-full shadow transform peer-checked:translate-x-5 transition-transform"></div>
        </label>
      </div>
    </div>

    <!-- Thermal Mode -->
    <div class="px-6 mt-6">
      <label class="block mb-2 font-semibold text-sm">Thermal Throttling</label>
      <div class="flex justify-between items-center bg-zinc-800 px-4 py-3 rounded-xl shadow">
        <div class="flex items-center space-x-2">
          <img src="assets/heat.svg" alt="Thermal" class="w-5 h-5" />
          <span id="thermal-status">Enabled</span>
        </div>
        <!-- Toggle Switch -->
        <label class="relative inline-flex items-center cursor-pointer">
          <input id="thermal-toggle" type="checkbox" class="sr-only peer">
          <div class="w-11 h-6 bg-zinc-700 peer-focus:outline-none rounded-full peer peer-checked:bg-red-500 transition-colors"></div>
          <div class="absolute left-0.5 top-0.5 w-5 h-5 bg-white rounded-full shadow transform peer-checked:translate-x-5 transition-transform"></div>
        </label>
      </div>
    </div>

    <!-- Other Tweaks -->
    <div class="px-6 mt-6">
      <label class="block mb-2 font-semibold text-sm">Other Tweaks</label>
      <div class="space-y-3">
        <div class="flex justify-between items-center bg-zinc-800 px-4 py-3 rounded-xl shadow">
          <div class="flex items-center space-x-2">
            <img src="assets/optimize.svg" alt="Dex Optimization" class="w-5 h-5" />
            <span>Dex Optimization</span>
          </div>
          <!-- Toggle Switch -->
          <label class="relative inline-flex items-center cursor-pointer">
            <input type="checkbox" class="sr-only peer">
            <div class="w-11 h-6 bg-zinc-700 peer-focus:outline-none rounded-full peer peer-checked:bg-red-500 transition-colors"></div>
            <div class="absolute left-0.5 top-0.5 w-5 h-5 bg-white rounded-full shadow transform peer-checked:translate-x-5 transition-transform"></div>
          </label>
        </div>
        <div class="flex justify-between items-center bg-zinc-800 px-4 py-3 rounded-xl shadow">
          <div class="flex items-center space-x-2">
            <img src="assets/optimize.svg" alt="ART Optimization" class="w-5 h-5" />
            <span>ART Optimization</span>
          </div>
          <!-- Toggle Switch -->
          <label class="relative inline-flex items-center cursor-pointer">
            <input type="checkbox" class="sr-only peer">
            <div class="w-11 h-6 bg-zinc-700 peer-focus:outline-none rounded-full peer peer-checked:bg-red-500 transition-colors"></div>
            <div class="absolute left-0.5 top-0.5 w-5 h-5 bg-white rounded-full shadow transform peer-checked:translate-x-5 transition-transform"></div>
          </label>
        </div>
      </div>
    </div>

    <!-- About Modules -->
    <div class="px-6 mt-6 mb-8">
      <label class="block mb-2 font-semibold text-sm">About Modules</label>
      <div class="bg-zinc-800 rounded-xl px-4 py-3 flex items-center justify-between shadow">
        <div class="text-sm">
          <p>Author<br><span class="text-gray-400">Belowzeroiq</span></p>
          <p>Telegram<br><span class="text-gray-400">t.me/belowzeroiq</span></p>
        </div>
        <div class="flex flex-col space-y-3 items-end ml-4">
          <a href="https://github.com/belowzeroiq" target="_blank" rel="noopener noreferrer" class="hover:text-white transition-colors" title="GitHub">
            <img src="assets/github.svg" alt="Author" class="w-6 h-6 inline" style="filter: invert(1) brightness(2);" />
          </a>
          <a href="https://t.me/belowzeroiq" target="_blank" rel="noopener noreferrer" class="hover:text-white transition-colors" title="Telegram">
            <img src="assets/telegram.svg" alt="Telegram" class="w-6 h-6 inline" style="filter: invert(1) brightness(2);" />
          </a>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="fixed left-1/2 -translate-x-1/2 bottom-6 z-50 bg-zinc-800 text-white px-6 py-3 rounded-xl shadow-lg opacity-0 pointer-events-none transition-all duration-300"></div>

  <script>
    // filepath: /home/env/Documents/GitHub/tnf_tweaker/webroot/index.html
    document.addEventListener('DOMContentLoaded', () => {
      const profileSelect = document.getElementById('profile-select');
      const profileIcon = document.getElementById('profile-icon');
      const applyProfileBtn = document.getElementById('apply-profile');
      const icons = {
        powersave: 'assets/powersave.svg',
        balanced: 'assets/balanced.svg',
        performance: 'assets/performance.svg'
      };
      profileSelect.addEventListener('change', (e) => {
        profileIcon.src = icons[e.target.value] || icons.balanced;
        showToast(`Profile set to ${e.target.options[e.target.selectedIndex].text}`);
      });
      // Set initial icon
      profileIcon.src = icons[profileSelect.value] || icons.balanced;

      // Apply button notification
      if (applyProfileBtn) {
        applyProfileBtn.addEventListener('click', () => {
          const selectedText = profileSelect.options[profileSelect.selectedIndex].text;
          showToast(`Applied profile: ${selectedText}`);
        });
      }

      // Bypass Charging toggle logic
      const bypassToggle = document.getElementById('bypass-toggle');
      const bypassStatus = document.getElementById('bypass-status');
      if (bypassToggle && bypassStatus) {
        bypassToggle.addEventListener('change', (e) => {
          bypassStatus.textContent = e.target.checked ? 'Enabled' : 'Disabled';
          showToast(`Bypass Charging ${e.target.checked ? 'enabled' : 'disabled'}`);
        });
      }

      // Attach to all other toggle switches
      document.querySelectorAll('input[type="checkbox"]').forEach(toggle => {
        // Skip bypass toggle (already handled)
        if (toggle.id === 'bypass-toggle') return;
        toggle.addEventListener('change', (e) => {
          const label = e.target.closest('.flex.items-center.space-x-2')?.innerText ||
                        e.target.closest('.flex.items-center')?.innerText ||
                        'Setting';
          showToast(`${label.trim()} ${e.target.checked ? 'enabled' : 'disabled'}`);
        });
      });

      // Refresh button notification
      const refreshBtn = document.getElementById('refresh-btn');
      if (refreshBtn) {
        refreshBtn.addEventListener('click', () => {
          showToast('Refreshed!');
        });
      }

      // Thermal toggle logic (if present)
      const thermalToggle = document.querySelector('#thermal-toggle');
      if (thermalToggle) {
        thermalToggle.addEventListener('change', (e) => {
          if (e.target.checked) {
            disableThermal();
          }
        });
      }

      // Example: Execute button logic (if present)
      const button = document.getElementById('execute-button');
      const output = document.getElementById('output');
      if (button && output) {
        button.addEventListener('click', async () => {
          output.textContent = 'Executing...';
          try {
            const response = await fetch('/api/execute', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ command: 'your-command-here' })
            });
            const data = await response.json();
            output.textContent = `Result: ${data.result}`;
          } catch (error) {
            output.textContent = `Error: ${error.message}`;
          }
        });
      }

      // Fetch device model from backend
      fetch('/api/device/model')
        .then(res => res.json())
        .then(data => {
          document.getElementById('device-model').textContent = data.model || 'Unknown';
        })
        .catch(() => {
          document.getElementById('device-model').textContent = 'Unavailable';
        });

      // Fetch kernel version from backend (should run `uname -r`)
      fetch('/api/device/kernel')
        .then(res => res.json())
        .then(data => {
          document.getElementById('kernel-version').textContent = data.version || 'Unknown';
        })
        .catch(() => {
          document.getElementById('kernel-version').textContent = 'Unavailable';
        });

      // Check if module is installed properly
      fetch('/api/module/status')
        .then(res => res.json())
        .then(data => {
          const statusSpan = document.getElementById('module-status');
          if (data.installed) {
            statusSpan.textContent = 'Working';
            statusSpan.classList.remove('text-red-400');
            statusSpan.classList.add('text-green-400');
          } else {
            statusSpan.textContent = 'Fail';
            statusSpan.classList.remove('text-green-400');
            statusSpan.classList.add('text-red-400');
          }
        })
        .catch(() => {
          const statusSpan = document.getElementById('module-status');
          statusSpan.textContent = 'Fail';
          statusSpan.classList.remove('text-green-400');
          statusSpan.classList.add('text-red-400');
        });

      // Fetch module version from GitHub releases
      fetch('https://api.github.com/repos/topnotchfreaks/tnf_tweaker/releases/latest')
        .then(res => res.json())
        .then(data => {
          document.getElementById('module-version').textContent = data.tag_name || 'Unknown';
        })
        .catch(() => {
          document.getElementById('module-version').textContent = 'Unavailable';
        });

      // Thermal Throttling toggle logic
      //const thermalToggle = document.getElementById('thermal-toggle');
      const thermalStatus = document.getElementById('thermal-status');
      if (thermalToggle && thermalStatus) {
        thermalToggle.addEventListener('change', async (e) => {
          if (e.target.checked) {
            // Disable thermal throttling
            const result = await setThermalThrottling(false);
            thermalStatus.textContent = result ? 'Disabled' : 'Enabled';
            showToast(`Thermal Throttling ${result ? 'disabled' : 'failed to disable'}`);
          } else {
            // Enable thermal throttling
            const result = await setThermalThrottling(true);
            thermalStatus.textContent = result ? 'Enabled' : 'Disabled';
            showToast(`Thermal Throttling ${result ? 'enabled' : 'failed to enable'}`);
          }
        });
      }
    });

    // Toast notification function
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.remove('opacity-0', 'pointer-events-none');
      toast.classList.add('opacity-100');
      clearTimeout(window._toastTimeout);
      window._toastTimeout = setTimeout(() => {
        toast.classList.remove('opacity-100');
        toast.classList.add('opacity-0', 'pointer-events-none');
      }, 2000); // 2 seconds timeout
    }

    // Example: Disable thermal throttling via KernelSU WebUI API
    async function disableThermal() {
      try {
        const response = await fetch('/api/execute', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ command: 'echo 0 > /sys/class/thermal/thermal_zone0/mode' })
        });
        const data = await response.json();
        if (data.result) {
          showToast('Thermal throttling disabled!');
        } else {
          showToast('Failed to disable thermal throttling.');
        }
      } catch (error) {
        showToast('Error: ' + error.message);
      }
    }

    // Set thermal throttling state
    async function setThermalThrottling(enable) {
      try {
        const command = enable
          ? 'echo enabled > /sys/class/thermal/thermal_zone0/mode'
          : 'echo disabled > /sys/class/thermal/thermal_zone0/mode';
        const response = await fetch('/api/execute', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ command })
        });
        const data = await response.json();
        return !!data.result;
      } catch {
        return false;
      }
    }
  </script>
</body>
</html>
